<!DOCTYPE html>
<html>

<head>
 <title>BugGuess</title>
 <!-- Prevent scaling -->
 <meta name="viewport" content="user-scalable=no, width=device-width" />
 <!-- Eliminate url and button bars if added to home screen -->
 <meta name="apple-mobile-web-app-capable" content="yes" />
 <!-- Choose how to handle the phone status bar -->
 <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />
 <!-- Specify a 320x460 start-up image. -->
 <link rel="apple-touch-startup-image" href="./images/bug_icon_large.png" />

 <!-- Choose a 144x144 image for the icon -->
 <link rel="apple-touch-icon" href="./images/bug_icon_sm.png" /> 

 <style>
  body {
   margin: 0px ;
   padding: 0px ;
   color: #222222;
   font-family: Helvetica;
   font-size: 14px ;
  }
</style>
 
 <script src="static/lib/d3.v3.min.js" type="text/javascript"> </script>
 <script src="static/lib/jquery-min.js" type="text/javascript"> </script>

 <script src='static/js/stimuli.js'></source>
 <script type="text/javascript">
   // To be called when there's a move event on the body itself:
   function BlockMove(event) {
     // Tell Safari not to move the window.
     event.preventDefault() ;
   }
 </script>
</head>

<body ontouchmove="blockMove(event);">

<div id="container">

<h3>Instructions</h3>
<p>Try to find out which house Rover lives in. You can either click on each house, or you can ask a yes or no question like "Does his house have a window?"</p>

<canvas id="display" width="2048" height="1536" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>
  // Tell Safari not to move the window when there's a move event on the body itself
  function blockMove(event) {
    event.preventDefault() ;
  }

	var margin_x = 100;
	var margin_y = 100;
	var offset = 200;
	var button_size = 120;
	var button_y = margin_y+2*offset + 40;
	var button_offset = button_size + 45;
	var button_text_color = '#EEEEEE';
	var touches = []; // store time, location, and element for each touch
  var owners = ["Joe","Rover","Lucy","Tina"];
  var answer = "Rover";

	var elem = document.getElementById('display'),
      elemLeft = elem.offsetLeft,
      elemTop = elem.offsetTop,
      context = elem.getContext('2d'),
      elements = getHouses(),
      buttons = getButtons();


  // Add event listener for `click` events.
  elem.addEventListener('click', function(event) {
      var x = event.pageX - elemLeft,
        y = event.pageY - elemTop;

      // Collision detection between clicked offset and element.
      elements.forEach(function(element) {
          if (y > element.top && y < element.top + element.height && x > element.left && x < element.left + element.width) {
              //alert('clicked an element');
              //elements.splice(element); // remove the house
              if(element.owner==answer) {
                drawTextbox("Good job!", 100, 200);
                //pause(2000);
                setInterval(function(){
                  context.clearRect(0, 0, elem.width, elem.height);
                }, 2000);
              } else {
                drawTextbox("No, try again!", 100, 200);
                //pause(2000);
                setInterval(function(){
                  context.clearRect(0, 0, elem.width, elem.height);
                }, 2000);
                //drawDisplay(context);
              }
          }
      });

      buttons.forEach(function(button) {
          if (y > button.top && y < button.top + button.height && x > button.left && x < button.left + button.width) {
              alert('clicked button: '+button.text);
          }
      });
  }, false);


  function drawDisplay(context) {
    var notDone = 1;
    //while(notDone) {
      drawStimuli(elements);
      drawButtons(buttons);
    //}
  }

  setInterval(drawDisplay(context), 100);

  function drawTextbox(text, top, left) {
      var height = context.measureText(text).height * 1.2;
      var width = context.measureText(text).width *1.2;
      context.fillStyle = "#444444";
      context.fillRect(left, top, width, height);
      context.font='22px Verdana';
      context.fillStyle = "#000000";
      context.fillText(text, left+10, top+33);
  }

  function pause(ms) {
    ms += new Date().getTime();
    while (new Date() < ms){}
  } 

	function drawStimuli(elements) {
		elements.forEach(function(element) {
			element.image.src = element.src;
			element.image.onload = function() {
    			context.drawImage(element.image, element.left, element.top);
			};
		});
	}
	
	function drawButtons(buttons) {
		buttons.forEach(function(button) {
			context.fillStyle = button.color;
		    context.fillRect(button.left, button.top, button.width, button.height);
		    context.font='22px Verdana';
    	    context.fillStyle = button_text_color;
    	    context.fillText(button.text, button.left+10, button.top+33);
		});
	}


</script>

  </div>
 </body>
</html>
