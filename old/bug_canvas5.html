<!DOCTYPE html>
<html>
<body>

<canvas id="bug1" width="2048" height="1536" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

 <!-- <script src="static/lib/d3.v3.min.js" type="text/javascript"> </script> -->
 <!-- <script src="static/lib/jquery-min.js" type="text/javascript"> </script> -->

<script src="static/js/stimuli.js" type="text/javascript"> </script>
<script type="text/javascript">
	var WIDTH = 2048;
	var HEIGHT = 1536;
	var c = document.getElementById("bug1");
	var ctx = c.getContext("2d");
	//var bugParts = getBugParts();
	var bugParts = getImages();


	var BugOLD = function(pars) {
		var self = this;

		//self.src = pars['src'];
		//self.width = pars['width'];
		//self.height: pars['height'];
		self.top = pars['top']; 
		self.left = pars['left'];
		self.owner = pars['owner'];
		self.body = bugParts[pars['body']]; // need to look up bugParts id...
		self.eyes = bugParts[pars['eyes']];
		self.legs = bugParts[pars['legs']];
		self.antennae = bugParts[pars['antennae']];
		self.star = bugParts[pars['star']];
		self.triangle = bugParts[pars['triangle']];
		self.headband = bugParts[pars['headband']];
		self.freckles = bugParts[pars['freckles']];
	}

	var Bug = function(pars) {
		var self = this;

		//self.src = pars['src'];
		//self.width = pars['width'];
		//self.height: pars['height'];
		self.top = pars['top']; 
		self.left = pars['left'];
		self.owner = pars['owner'];
		self.body = pars['body']; // need to look up bugParts id...
		self.eyes = pars['eyes'];
		self.legs = pars['legs'];
		self.antennae = pars['antennae'];
		self.star = pars['star'];
		self.triangle = pars['triangle'];
		self.headband = pars['headband'];
		self.freckles = pars['freckles'];
	}

	// var mapBugFeatures() = function() {}

	var buildBugs = function() {
		// should accept a mapping vector that specifies which parts
		var bugs = [];
		// body: 1-2, wings: 3 or 3+4, eyes: 5-6, legs: 7-8, antennae: 9, star: 10, triangle: 11, headband: 12-13
		var b = new Bug({
			top: 100,
			left: 400,
			owner: 'Tim',
			body: 1, 
			eyes: 5,
			legs: 7,
			antennae: 9,
			star: 10,
			triangle: 11,
			headband: 12,
			freckles: 14
		});
		bugs.push(b);

		var c = new Bug({
			top: 5,
			left: 5,
			owner: 'Me',
			body: 1, 
			eyes: 5,
			legs: 7,
			antennae: 0,
			star: 10,
			triangle: 0,
			headband: 12,
			freckles: 0
		});
		bugs.push(c);
		//bugs.push(c);
		bugs.push(b);
		return bugs;
	}

	// to draw on one big canvas? (for now) or an individual (class) canvas for each bug? -- latter may be smarter (easier to update?)
	function drawBug(bug, ctx, bugParts) {
		// body: 1-2, wings: 3 or 3+4, eyes: 5-6, legs: 7-8, antennae: 9, star: 10, triangle: 11, headband: 12-13
		
		//ctx.drawImage(bugParts[bug[key].image], bug.left + bugParts[bug[key]].left, bug.top + bugParts[bug[key]].top);
		for (var key in bug) {
			if(key!='top' && key!='left' && key!='owner') {
				if(bug[key]!=0) {
					//console.log(key);
					//bug[key].image.onload = function() {
						//ctx.drawImage(bugParts[bug[key].image], bug.left + bugParts[bug[key]].left, bug.top + bugParts[bug[key]].top);
						//console.log(bug[key]);
						//console.log(bugParts[bug[key]]);
						ctx.drawImage(bugParts[bug[key]].image, 50, 50);
						//ctx.drawImage(bugParts[bug[key]].image, bug.left + bugParts[bug[key]].left, bug.top + bugParts[bug[key]].top);
						//ctx.fillStyle = "#000000";
						//ctx.fillRect(bug.left + bugParts[bug[key]].left, bug.top + bugParts[bug[key]].top, bugParts[bug[key]].width, bugParts[bug[key]].height);
					//}
					//bug[key].image.src = bug[key].src; // maybe should do this once in getBugParts?
				}
				//console.log(bug.left + " " + bug[key].left + " " + bug.top + " " + bug[key].top);
			}
		}
	}

	function drawBug2(bug, ctx) {
		ctx.drawImage(bugParts[bug.body], bug.left + bugParts[bug.body].left, bug.top + bugParts[bug.body].top);
		ctx.drawImage(bugParts[bug.legs], bug.left + bugParts[bug.legs].left, bug.top + bugParts[bug.legs].top);
	}

	// drawBug
	function drawArray(bugs, nrows, ncols, ctx) {
		bugs.forEach(function(element) {
			element.image.src = element.src;
			element.image.onload = function() {
    			ctx.drawImage(element.image, element.left, element.top);
    			console.log(element.image.src + " " + element.left + " " + element.top);
			};
		});
	}

    function drawPart(element, ctx) {
		ctx.drawImage(element.image, element.left, element.top);
		console.log(imgs.src + " " + element.left + " " + element.top);
	}

	function drawParts(bugParts, ctx) {
		for(i = 0; i<bugParts.length; i++) {
			ctx.drawImage(bugParts[i], 50, 50);
		}
	}

	var bugs = buildBugs();
	drawParts(bugParts, ctx);

</script>

</body>
</html>
