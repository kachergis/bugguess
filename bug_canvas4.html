<!DOCTYPE html>
<html>
<body>

<canvas id="bug1" width="2048" height="1536" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script src="static/js/stimuli.js" type="text/javascript"> </script>
<script type="text/javascript">
	var WIDTH = 2048;
	var HEIGHT = 1536;
	var c = document.getElementById("bug1");
	var ctx = c.getContext("2d");
	var bugParts = getBugParts();

	var Bug = function(pars) {
		var self = this;

		//self.src = pars['src'];
		//self.width = pars['width'];
		//self.height: pars['height'];
		self.top = pars['top'];
		self.left = pars['left'];
		self.owner = pars['owner'];
		self.body = bugParts[pars['body']]; // need to look up bugParts id...
		self.eyes = bugParts[pars['eyes']];
		self.legs = bugParts[pars['legs']];
		self.antennae = bugParts[pars['antennae']];
		self.star = bugParts[pars['star']];
		self.triangle = bugParts[pars['triangle']];
		self.headband = bugParts[pars['headband']];
		self.freckles = bugParts[pars['freckles']];
	}

	// var mapBugFeatures() = function() {}

	var buildBugs = function() {
		// should accept a mapping vector that specifies which parts
		var bugs = [];
		// body: 1-2, wings: 3 or 3+4, eyes: 5-6, legs: 7-8, antennae: 9, star: 10, triangle: 11, headband: 12-13
		var b = new Bug({
			top: 100,
			left: 400,
			owner: 'Tim',
			body: 1, 
			eyes: 5,
			legs: 7,
			antennae: 9,
			star: 10,
			triangle: 11,
			headband: 12,
			freckles: 14
		});
		bugs.push(b);

		var c = new Bug({
			top: 5,
			left: 5,
			owner: 'Me',
			body: 1, 
			eyes: 5,
			legs: 7,
			antennae: 0,
			star: 10,
			triangle: 0,
			headband: 12,
			freckles: 0
		});
		bugs.push(c);
		bugs.push(c);
		bugs.push(b);
		return bugs;
	}

	// to draw on one big canvas? (for now) or an individual (class) canvas for each bug? -- latter may be smarter (easier to update?)
	function drawBug(bug, ctx) {
		// body: 1-2, wings: 3 or 3+4, eyes: 5-6, legs: 7-8, antennae: 9, star: 10, triangle: 11, headband: 12-13
		for (var key in bug) {
			if(key!='top' && key!='left' && key!='owner') {
				if(bug[key]!=0) {
					bug[key].image.onload = function() {
						ctx.drawImage(bug[key].image, bug.left + bug[key].left, bug.top + bug[key].top);
					}
					//bug[key].image.src = bug[key].src; // maybe should do this once in getBugParts?
				}
				//console.log(bug.left + " " + bug[key].left + " " + bug.top + " " + bug[key].top);
			}
		}
	}

	// drawBug
	function drawArray(bugs, nrows, ncols, ctx) {
		bugs.forEach(function(element) {
			element.image.src = element.src;
			element.image.onload = function() {
    			ctx.drawImage(element.image, element.left, element.top);
    			console.log(element.image.src + " " + element.left + " " + element.top);
			};
		});
	}

    function drawPart(element, ctx) {
		element.image.src = element.src;
		element.image.onload = function() {
			ctx.drawImage(element.image, element.left, element.top);
			console.log(element.image.src + " " + element.left + " " + element.top);
		}
	}

	//window.onload = function(ctx) {
		var bugs = buildBugs();
		console.log(bugs[0]);
		drawBug(bugs[0], ctx);
		drawBug(bugs[1], ctx);
		//drawPart(bugParts[1], ctx);

		//ctx.fillStyle = "rgb(200,0,0)";  
		//ctx.fillRect(10, 10, 55, 50);
	//}

	// wait one second before starting
    //setTimeout(function() {
   //     var startTime = (new Date()).getTime();
   //     doExp(ctx, startTime);
    //}, 1000);
</script>

</body>
</html>
